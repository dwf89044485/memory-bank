# Memory-Bank 技能开发历程

**项目**：CodeBuddy Memory-Bank 技能包
**目标**：为产品设计项目建立记忆库，让 AI 在每次新会话时自动了解项目背景

---

## 开发时间线

| 时间 | 对话 | 核心问题 | 解决方案 | 决策 |
|------|------|----------|----------|------|
| 19:00 | #1 | 文件链接无法点击 | 反引号 + 相对路径 | #7 |
| 19:05 | #2 | 访谈回复过于冗长 | 严格访谈模板 | #9 |
| 19:10 | #3 | 模型跳过用户选择 | `<critical>` 强制等待 | #10 |
| 19:15 | #4 | 系统元信息污染 brief | 检索路径过滤 | #11 |
| 19:18 | #5 | 模板文件丢失 | 从备份恢复 | - |
| 19:20 | #6 | 扩展文件生成逻辑模糊 | 明确检测标准 | #12 |
| 19:22 | #7 | 执行完整更新流程 | 生成 decisions.mdc | #13 |
| 19:25 | #8 | 时间获取方式固化 | 写入 reasoning-guide.md | #13 更新 |
| 19:30 | #9 | 保存开发历程 | 本文档 | - |

> 决策详情见 `.codebuddy/rules/decisions.mdc`

---

## 问题解决详情

### 对话 1：文件链接格式

**现象**：生成的文件链接在 IDE 对话框中无法点击打开

**测试**：
```
纯文本路径          → ❌
带括号纯文本        → ❌
反引号 + 相对路径   → ✅
反引号 + 纯文件名   → ✅
```

**修复**：更新 `SKILL.md` 和 `reasoning-guide.md` 中的 8 处文件链接

---

### 对话 2：访谈指南优化

**现象**：
- 问了 5 个问题（应该只问 3 个）
- 添加冗长引导语（"尽量一句话回答即可"）
- 询问可选信息（产品类型、目标用户）

**根因**：`interview-guide.md` 只有原则性指导，缺少强制性模板

**修复**：重写 `interview-guide.md`
- 添加强制性回复模板
- 只问 3 个必要问题
- 总字数 ≤ 50 字

---

### 对话 3：强制等待用户选择

**现象**：
- 应该展示 3 选项让用户选择
- 模型自作主张选了"选项 3"
- 跳过了用户交互

**根因**：`SKILL.md` 是声明式描述，没有强制约束

**修复**：在 `SKILL.md` 添加：
```xml
<critical>必须停下来等待用户选择</critical>
<wait_for_user_selection>不要继续执行</wait_for_user_selection>
```

---

### 对话 4：检索路径过滤

**现象**：把 `.codebuddy/skills` 中的技能定义当作"项目文档"，污染用户 brief

**修复**：在 `SKILL.md` 和 `reasoning-guide.md` 中明确排除：
- `.codebuddy/`
- `node_modules`
- `.git`

---

### 对话 5：模板文件恢复

**现象**：`references/` 文件夹丢失 4 个关键文件

**修复**：从 `/memory-bank/` 备份恢复

---

### 对话 6：扩展文件生成逻辑

**现象**：`reasoning-guide.md` 中的检测逻辑过于模糊，模型不知道何时生成 `decisions.mdc`

**修复**：明确触发条件
- `decisions.mdc`：brief 中有 3+ 条决策
- `assets.mdc`：检测到 Figma/设计系统/组件库
- 直接生成 `.mdc`，无需二次确认

---

## 最终文件结构

```
.codebuddy/
├── skills/memory-bank/
│   ├── SKILL.md                    # 主流程
│   └── references/
│       ├── reasoning-guide.md      # 推导指南
│       ├── interview-guide.md      # 访谈模板
│       ├── brief-template.mdc      # brief 模板
│       ├── decisions-template.mdc  # decisions 模板
│       └── assets-template.mdc     # assets 模板
└── rules/
    ├── brief.mdc                   # 核心上下文（~700字）
    └── decisions.mdc               # 完整决策记录
```

---

## 关键洞察

### 1. 声明式 vs 强制性

| 问题 | 解决 |
|------|------|
| 仅描述"应该做什么" | 添加 `<critical>`、`<wait_for_*>` 强制指令 |

> AI 会"善意地"帮用户做决定，必须明确禁止

### 2. 模糊 vs 明确

| 问题 | 解决 |
|------|------|
| "检查是否有决策记录" | "3+ 条决策记录" |

> AI 需要明确的触发条件，不能依赖模糊判断

### 3. 原则 vs 模板

| 问题 | 解决 |
|------|------|
| 仅提供原则性指导 | 提供强制性回复模板 |

> 减少模型自由度 = 提升行为可预测性

### 4. 集中 vs 分散

| 问题 | 解决 |
|------|------|
| 所有信息集中一个文件 | 核心文件 + 扩展文件 |

> 分层存储：核心简洁 + 信息完整

---

## 待办事项

- [ ] 在更多实际项目中验证整体流程
- [ ] 收集用户反馈，迭代优化
- [ ] 端到端测试
- [ ] Windows 平台时间命令兼容性
- [ ] 考虑 MCP time 工具作为替代

---

*创建时间：2026-01-08 19:22*
*最后更新：2026-01-08*
