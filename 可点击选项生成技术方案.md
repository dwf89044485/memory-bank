# 可点击选项生成技术方案

## 概述

本文档记录了在 IDE 环境中，大模型如何通过特定工具调用格式生成可点击选项的技术实现方案。

## 核心机制

### 使用工具

大模型通过调用 `ask_followup_question` 工具来生成可点击选项，该工具专门用于在用户界面显示选择性问题。

### 工具参数

| 参数 | 类型 | 必需 | 描述 |
|------|------|------|------|
| `question` | string | 是 | 向用户提出的问题 |
| `options` | string | 是 | JSON 格式的字符串数组，包含 2-5 个选项 |

## 格式要求

### Options 参数格式

**严格要求：**
- 必须是有效的 JSON 字符串
- 使用双引号 `"` 而非单引号 `'`
- 数组格式：`["选项1", "选项2", "选项3"]`
- 特殊字符需要转义：`"[待补充]"`

**错误示例：**
```json
['单引号选项']  // 错误：使用单引号
["未转义引号]   // 错误：引号未闭合
(括号选项)      // 错误：使用括号
```

**正确示例：**
```json
["选项一", "选项二", "选项三"]
["直接创建，缺失信息标注\"[待补充]\""]
```

### 选项数量限制

- **最少：** 2 个选项
- **最多：** 5 个选项
- **推荐：** 3-4 个选项，平衡选择复杂度与覆盖度

## 实现流程

### 1. 场景识别

大模型在以下场景应生成可点击选项：
- 需要用户在多个方案中选择时
- 信息不完整需要用户澄清时
- 有多个可行路径需要用户决策时
- 避免开放式输入，提高交互效率时

### 2. 工具调用

```javascript
// 伪代码示例
const options = [
  "性能优化 - 提升规则执行速度和响应时间",
  "易用性改进 - 简化配置界面和降低学习成本",
  "功能扩展 - 增加更多高级规则和自定义能力"
];

ask_followup_question({
  question: "EdgeOne 规则引擎优化项目接下来应该重点关注哪个方面？",
  options: JSON.stringify(options)
});
```

### 3. 用户交互

1. IDE 自动将 options 渲染为可点击按钮
2. 用户点击选项后，选择结果返回给大模型
3. 大模型根据选择结果继续处理流程
4. **重要：** 大模型必须等待用户选择后才能进行下一步操作

### 4. 响应处理

大模型收到用户选择后，应在下一轮对话中：
- 不直接显示选项内容
- 基于用户选择继续业务逻辑
- 避免使用相同的选项重复提问

## 实际应用示例

### 示例 1：初始化方式选择

```javascript
ask_followup_question({
  question: "请选择初始化方式",
  options: "[\"将资料放入项目文件夹，我读取后建立\", \"通过对话快速创建\", \"直接创建，缺失信息标注\"[待补充]\"\"]"
});
```

### 示例 2：工作重点选择

```javascript
ask_followup_question({
  question: "EdgeOne 规则引擎优化项目接下来应该重点关注哪个方面？",
  options: "[\"性能优化 - 提升规则执行速度和响应时间\", \"易用性改进 - 简化配置界面和降低学习成本\", \"功能扩展 - 增加更多高级规则和自定义能力\", \"稳定性提升 - 减少错误率和提高可靠性\"]"
});
```

### 示例 3：验证方法选择

```javascript
ask_followup_question({
  question: "您希望如何验证规则引擎优化的效果？",
  options: "[\"性能测试 - 通过基准测试对比优化前后的执行效率\", \"用户反馈 - 收集实际使用者的体验和满意度评价\", \"A/B测试 - 在生产环境中对比新旧版本表现\", \"监控指标 - 分析错误率、响应时间等关键指标变化\"]"
});
```

## 最佳实践

### 选项设计原则

1. **互斥性：** 选项之间不应重叠或包含关系
2. **完整性：** 选项应覆盖主要可能性
3. **明确性：** 每个选项应有清晰的行动指向
4. **简洁性：** 避免过长描述，突出核心差异

### 问题设计原则

1. **单一焦点：** 每个问题只关注一个决策点
2. **情境相关：** 问题应与当前业务场景紧密相关
3. **行动导向：** 问题应引导用户做出可执行的选择

### 错误处理

1. **格式验证：** 确保 options 是有效 JSON
2. **长度检查：** 控制选项数量和长度
3. **编码处理：** 正确处理中文字符和特殊符号

## 技术注意事项

### JSON 序列化

在生成 options 字符串时，需要注意：
- 使用 `JSON.stringify()` 确保格式正确
- 手动转义内部引号和特殊字符
- 验证生成的字符串可被 JSON.parse() 正确解析

### 字符编码

- 确保 UTF-8 编码支持中文显示
- 特殊符号需要适当转义
- 避免在选项文本中使用换行符

### 性能考虑

- 选项数量控制在合理范围内
- 避免生成过大的 JSON 字符串
- 及时清理不再使用的选项状态

## 调试技巧

1. **格式验证：** 使用 JSON 校验工具检查 options 格式
2. **预览测试：** 在小范围场景先测试选项渲染效果
3. **用户反馈：** 观察用户选择和响应时间优化选项设计

## 总结

可点击选项生成的核心是通过标准化的工具调用格式，将大模型的决策需求转化为用户友好的可视化选择界面。关键在于严格的格式规范和合理的选项设计，确保用户体验和系统稳定性的平衡。