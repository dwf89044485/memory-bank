---
name: memory-bank
description: 为产品设计项目建立记忆库，让 AI 记住项目背景和上下文。当用户提到"建立/初始化/更新 记忆/上下文"、"让 AI 记住/了解项目"、"新会话需要项目背景"、"产品规划/需求评审/设计评审"、"项目 onboarding"时使用。支持产品经理和产品设计师在每次新对话时快速建立协作上下文。
---

# 产品设计记忆库

为产品经理和产品设计师建立「设计记忆库」，让 AI 在每次新会话时自动了解项目背景。

## 执行约束

1. 使用数字序号引导用户选择，数字用反引号包裹增强视觉
2. 明确等待用户输入数字选择，不自行决定分支
3. 提示格式："**请回复数字选择：**" 后跟选项列表

## 核心理念

- **多源信息收集**：同时检索项目文件夹文档和分析对话历史
- **上下文窗口宝贵**：核心文件简洁为主，避免冗余描述
- **直接生效**：生成 `.mdc` 文件立即生效，用户可随时完善

## 输出文件

```
.codebuddy/rules/
├── brief.mdc              # Always - 核心上下文
├── decisions.mdc          # Agent Requested - 决策记录（可选）
└── assets.mdc             # Agent Requested - 设计资产（可选）
```

## 工作流程

### Step 1: 信息收集

检索项目文件夹中的文档，排除以下目录：
- `.codebuddy/skills`、`.codebuddy/agents`、`.codebuddy/rules`
- `node_modules`、`.git`

同时分析对话历史，提取以下信息：
- **必要信息**：产品名称、对标竞品、当前工作焦点
- **可选信息**：产品定位、目标用户、场景、体验原则、决策、约束

### Step 2: 评估信息完整度

**信息齐全时**：读取 `references/reasoning-guide.md` 进行推导，跳转 Step 4

**信息不齐全时**：提示用户选择初始化方式

```
缺少创建记忆库的必要信息。

**请回复数字选择：**

`1` 将资料放入项目文件夹，我读取后建立  
`2` 通过对话快速创建  
`3` 直接创建，缺失信息标注 [待补充]
```

等待用户输入数字后执行对应分支。

### Step 3: 信息补充

根据用户输入的数字执行：
- **1**：等待用户放入资料，返回 Step 1
- **2**：读取 `references/interview-guide.md`，只问 3 个必要问题
- **3**：直接进入 Step 4

### Step 4: 生成记忆库文件

1. 读取 `references/reasoning-guide.md` 进行推导
2. 使用 `references/brief-template.mdc` 模板
3. **直接生成 `.codebuddy/rules/brief.mdc`**（立即生效）
4. 告知用户已生成，可随时修改完善

### Step 6: 生成扩展文件

**decisions.mdc（必须生成）**：
- 总是生成 decisions.mdc，记录初始化决策
- 根据初始化方式（文档/对话/示例）记录详细过程
- 如果 brief 中有 3+ 条其他决策，也提取到 decisions.mdc

**assets.mdc（条件生成）**：
- 检测 Figma 链接、设计系统、组件库
- 读取模板生成

**结束提示**：
- 以目录结构展示所有生成的文件
- 说明文件作用，提示可手动修改
- 告知记忆库已创建，开始记住项目背景

## 记忆更新

**触发命令**：`更新记忆` 或 `update memory`

**更新方式**：
- ⚠️ **关键**：直接修改 `.mdc` 文件，不要重新生成 `.md` 文件
- 使用 `replace_in_file` 工具进行定点修改
- 保留其他内容不变，只更新需要变更的部分

**更新原则**：
- **增量优先**：添加新信息，不轻易删除旧信息
- **具体化**：用具体替换模糊，用数据替换感觉
- **决策沉淀**：重要决策必须记录，包括放弃的选项

**更新信号**（AI 主动提醒）：
- 对话内容与 brief 记录矛盾
- 出现重要决策（"我们决定..."、"最终选择..."）
- 补充了 [待补充] 的信息
- 项目阶段或工作焦点发生变化

**详细指南**：读取 `references/update-guide.md`

## 相关资源

| 资源 | 用途 |
|------|------|
| `references/brief-template.mdc` | 核心文件模板 |
| `references/reasoning-guide.md` | 推导指南（信息齐全时加载） |
| `references/interview-guide.md` | 访谈指南（需收集信息时加载） |
| `references/update-guide.md` | 更新指南（更新记忆时加载） |
| `references/decisions-template.mdc` | 决策记录模板 |
| `references/assets-template.mdc` | 资产信息模板 |
